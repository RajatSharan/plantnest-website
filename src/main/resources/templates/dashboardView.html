<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="'PlantNest - Dashboard'">PlantNest - Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div th:replace="~{fragments/layout :: layout(~{::title}, ~{}, ~{::#content})}">
    <div id="content">
        <style>
            :root {
                --primary-green: #28a745;
                --darker-green: #218838;
                --light-green-bg: #d1fae5;
                --text-color: #333;
                --card-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            }

            body {
                font-family: 'Poppins', sans-serif;
                color: var(--text-color);
                background-color: #f8f9fa;
            }

            .navbar {
                background-color: var(--light-green-bg);
                border-bottom: 1px solid var(--primary-green);
            }

            .navbar-brand {
                font-weight: 700;
                color: var(--primary-green) !important;
            }

            .btn-primary, .btn-success, .badge-success {
                background-color: var(--primary-green);
                border-color: var(--primary-green);
            }

            .btn-primary:hover, .btn-success:hover {
                background-color: var(--darker-green);
                border-color: var(--darker-green);
            }

            .form-control:focus {
                border-color: var(--primary-green);
                box-shadow: 0 0 0 0.25rem rgba(40, 167, 69, 0.25);
            }

            .card {
                border: none;
                border-radius: 0.75rem;
                box-shadow: var(--card-shadow);
                transition: transform 0.2s ease-in-out;
            }

            .card:hover {
                transform: translateY(-5px);
            }

            .card-img-top {
                border-top-left-radius: 0.75rem;
                border-top-right-radius: 0.75rem;
                height: 180px;
                object-fit: cover;
            }

            .add-to-cart-btn {
                background-color: var(--primary-green);
                color: white;
                border: none;
                padding: 0.5rem 1rem;
                border-radius: 0.5rem;
                font-size: 0.9rem;
                transition: background-color 0.3s ease;
            }

            .add-to-cart-btn:hover {
                background-color: var(--darker-green);
            }

            .search-container {
                position: relative;
                width: 100%;
            }

            .search-input {
                padding-right: 2.5rem;
            }

            .search-icon {
                position: absolute;
                right: 0.75rem;
                top: 50%;
                transform: translateY(-50%);
                color: #ccc;
            }

            .cart-icon-badge {
                position: absolute;
                top: 5px;
                right: 5px;
                padding: 0.2em 0.5em;
                border-radius: 50%;
                background-color: red;
                color: white;
                font-size: 0.7em;
            }
        </style>

        <div class="container-fluid mt-3">
            <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
                <span th:text="${message}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <span th:text="${error}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </div>

        <div class="container mt-4">
            <div class="row">
                <div class="col-md-3">
                    <h5 class="mb-3">Search Plants</h5>
                    <form th:action="@{/dashboard}" method="get" class="mb-4">
                        <div class="input-group search-container">
                            <input type="text" class="form-control search-input" id="search-input" name="query" th:value="${query}" placeholder="Search by name...">
                            <span class="search-icon"><i class="fa-solid fa-magnifying-glass"></i></span>
                        </div>
                        <button type="submit" class="d-none">Submit</button>
                    </form>

                    <h5 class="mb-3">Recent Activities</h5>
                    <ul class="list-group">
                        <li th:each="activity : ${activities}" class="list-group-item d-flex justify-content-between align-items-center">
                            <span th:text="${activity.description}"></span>
                            <small th:text="${#temporals.format(activity.timestamp, 'dd MMM yyyy HH:mm')}"></small>
                        </li>
                        <li th:if="${#lists.isEmpty(activities)}" class="list-group-item text-muted">No recent activities.</li>
                    </ul>

                    <h5 class="mt-4 mb-3">Your Orders</h5>
                   <ul class="list-group">
                    <li th:each="order : ${orders}" class="list-group-item">
            <div>Order ID: <span th:text="${order.id}"></span></div>
            <div>Date: <span th:text="${#temporals.format(order.createdAt, 'dd MMM yyyy')}"></span></div>
            <div>Total: $<span th:text="${#numbers.formatDecimal(order.total, 1, 2)}"></span></div>
            <small class="text-muted" th:text="${order.status}"></small>
        </li>
    <li th:if="${#lists.isEmpty(orders)}" class="list-group-item text-muted">No orders placed yet.</li>
</ul>

                </div>

                <div class="col-md-9">
                    <h2 class="mb-4">Explore Our Plants</h2>
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        <div th:each="plant : ${products}" class="col">
                            <div class="card h-100 d-flex flex-column">
                                <img th:src="@{${plant.imageUrl}}" class="card-img-top" alt="Plant Image">
                                <div class="card-body d-flex flex-column">
                                    <h6 th:text="${plant.name}">Plant Name</h6>
                                    <div class="mb-3 fw-semibold" th:text="'$' + ${plant.price}">$0.00</div>
                                    <button
                                            class="btn add-to-cart-btn mt-auto"
                                            type="button"
                                            th:data-id="${plant.id}">
                                        Buy Now
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div th:if="${#lists.isEmpty(products)}" class="col-12">
                            <div class="alert alert-info text-center">No plants found matching your search.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="/js/cart.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const searchInput = document.getElementById('search-input');
                const searchForm = searchInput && searchInput.form;
                if (searchInput && searchForm) {
                    searchInput.addEventListener('input', function () {
                        if (this.value === '') {
                            searchForm.submit();
                        }
                    });
                }
            });
        </script>
    </div>
</div>
</body>
</html>
